<!DOCTYPE html>
<html>

<head>
    <title>WebRTC with WebSockets</title>
</head>

<body>
    <button id="start">Start</button>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const ws = new WebSocket("ws://localhost:8765");

            ws.addEventListener("open", function (event) {
                console.log("WebSocket connection opened:", event);

                const configuration = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };
                const pc = new RTCPeerConnection(configuration);

                document.getElementById("start").addEventListener("click", function () {
                    ws.send("Query example");

                    pc.createOffer()
                        .then(offer => pc.setLocalDescription(offer))
                        .then(() => {
                            ws.send(JSON.stringify({ "offer": pc.localDescription }));
                        });

                    // Trigger /run-at-time endpoint
                    const time = new Date().toISOString();
                    fetch(`http://localhost:8080/run-at-time/${time}`)
                        .then(response => response.text())
                        .then(data => console.log(data));
                });

                ws.addEventListener("message", function (event) {
                    console.log("Received data:", event.data);
                });
            });
        });
    </script>
</body>

</html>